{% extends "base.html" %}

{% load static %}
{% load crispy_forms_tags %}
{% load tag_library %}

{% block page_css %}
<link rel="stylesheet" type="text/css" href={% static "admin-theme/app-assets/css-rtl/pages/dashboard-analytics.css" %}>
<link rel="stylesheet" type="text/css" href={% static "admin-theme/app-assets/css-rtl/pages/card-analytics.css" %}>
{% endblock page_css %}

{% block main %}
<div class="row">

	{% include "elements/messages-section.html" %}

    <div class="col-12">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header d-flex align-items-start pb-0">
                        <div>
                            <h2 class="text-bold-700 mb-0">{{request.user.fund_of_investor.count}}</h2>
                            <p class="mt-25">تعداد صندوق های شما</p>
                        </div>
                        <div class="avatar bg-rgba-success p-50 m-0">
                            <div class="avatar-content">
                                <i class="feather icon-box text-success font-medium-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="col-md-3">
                <div class="card bg-gradient-success">
                    <div class="card-header d-flex align-items-start pb-0">
                        <div>
                            <h2 class="text-bold-700 mb-0 text-white">{% random_fund_amount as amounta %} {{amounta|intcomma}} واحد</h2>
                            <p class="mt-25 text-dark">حجم کلی سرمایه</p>
                        </div>
                        <div class="avatar bg-rgba-white p-50 m-0">
                            <div class="avatar-content">
                                <i class="fa fa-usd text-white font-medium-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header d-flex align-items-start pb-0">
                        <div>
                            <h2 class="text-bold-700 mb-0 text-dark">{% random_fund_amount as amount %} {{amount|add:amounta|intcomma}} واحد</h2>
                            <p class="mt-25 text-dark">اعتبار اختصاص داده شما</p>
                        </div>
                        <div class="avatar bg-rgba-success p-50 m-0">
                            <div class="avatar-content">
                                <i class="fa fa-usd text-success font-medium-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card">
                    <div class="card-header d-flex align-items-start pb-0">
                        <div>
                            <h2 class="text-bold-700 mb-0 text-dark">{% random_fund_amount as amountb %} {{amountb|intcomma}} واحد</h2>
                            <p class="mt-25 text-dark">اعتبار سرمایه گذاری شده</p>
                        </div>
                        <div class="avatar bg-rgba-success p-50 m-0">
                            <div class="avatar-content">
                                <i class="feather icon-users text-success font-medium-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="row">
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-12">
                        <div class="card overflow-hidden">
                            <div class="card-content">
                                <div class="card-body pb-0">
        
                                    <div class="accordion" id="accordionExample" data-toggle-hover="true">
                                        <div class="collapse-margin">
                                            <div class="card-header collapsed" id="headingOne" data-toggle="collapse" role="button" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                <span class="lead collapse-title collapsed">
                                                    <i class="feather icon-chevron-down mr-2"></i> <span class="font-weight-bold">فرم ساخت صندوق جدید</span>
                                                </span>
                                            </div>
        
                                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                                <div class="card-body">
        
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <form method="POST">
                                                                {% csrf_token %}
                                                                <input name="investor" value="{{request.user.id}}" hidden>
                                                                <div class="row">
                                                                    {% for field in fund_form %}
                                                                        {% if not field.name == "investor" %}
                                                                        <div class="col-6">
                                                                            {{field|as_crispy_field}}
                                                                        </div>
                                                                        {% endif %}
                                                                    {% endfor %}
        
                                                                    <div class="col-12">
                                                                        <button class="btn btn-success btn-block" type="submit">ثبت</button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
        
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        
                                    <div class="row mx-0 my-2 border">
                                        <div class="col-12 p-2">
                                            <h2 class="text-center">« لیست صندوق های شما »</h2>
                                            <div class="table-responsive">
                                                <table class="table table-striped mb-0 mt-2">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">#</th>
                                                            <th scope="col">نام سکوی سرمایه گذاری یا برنامه شتابدهی</th>
                                                            <th scope="col">حجم صندوق</th>
                                                            <th scope="col">اعتبار اختصاص داده شده</th>
                                                            <th scope="col">عملیات</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for item in request.user.fund_of_investor.all %}
                                                        <tr>
                                                            <th scope="row">{{forloop.counter}}</th>
                                                            <td>{{item.name}}</td>
                                                            <td><span class="badge badge-primary">{{item.amount|intcomma}}</span> </td>
                                                            <td>0</td>
                                                            <td>
                                                                <a href={% url "investor:update-fund" item.uuid %} class="badge badge-info">ویرایش</a>
                                                                <a href={% url "investor:delete-fund" item.uuid %} class="badge badge-danger">حذف <i class="feather icon-trash-2"></i></a>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
        
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">تاریخچه وقایع صندوق ها</h4>
                            </div>
                            <div class="card-content">
                                <div class="table-responsive mt-1">
                                    <table class="table table-hover-animation mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">صندوق</th>
                                                <th scope="col">محصول/شتابدهنده</th>
                                                <th scope="col">عملیات</th>
                                                <th scope="col">حجم</th>
                                                <th scope="col">تاریخ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>صندوق اول</td>
                                                <td>بوت کمپ تابستان ۱۴۰۳ - دیجی نکست</td>
                                                <td><i class="fa fa-circle font-small-3 text-success mr-50"></i>سرمایه گذاری</td>
                                                <td>{% random_fund_amount as amount %} {{amount|intcomma}} <span class="text-black-50">واحد</span></td>
                                                <td>1403/02/01</td>
                                            </tr>
                                            <tr>
                                                <td>صندوق اول</td>
                                                <td>برنامه شتابدهی زمستانه</td>
                                                <td><i class="fa fa-circle font-small-3 text-danger mr-50"></i>سلب اعتبار</td>
                                                <td>{% random_fund_amount as amount %} {{amount|intcomma}} <span class="text-black-50">واحد</span></td>
                                                <td>1403/01/25</td>
                                            </tr>
                                            <tr>
                                                <td>صندوق دوم</td>
                                                <td>از تیم سازنده های ابری</td>
                                                <td><i class="fa fa-circle font-small-3 text-danger mr-50"></i>بازگشت اعتبار</td>
                                                <td>{% random_fund_amount as amount %} {{amount|intcomma}} <span class="text-black-50">واحد</span></td>
                                                <td>1403/01/01</td>
                                            </tr>
                                            <tr>
                                                <td>صندوق سوم</td>
                                                <td>***</td>
                                                <td><i class="fa fa-circle font-small-3 text-success mr-50"></i>ایجاد صندوق</td>
                                                <td>{% random_fund_amount as amount %} {{amount|intcomma}} <span class="text-black-50">واحد</span></td>
                                                <td>1402/12/29</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between pb-0">
                                <h4>وضعیت سرمایه صندوق های شما</h4>
                            </div>
                            <div class="card-content">
                                <div class="card-body">
                                    <div id="product-order-chart-custom" class="mb-0"></div>
                                    <div class="chart-info d-flex justify-content-between mb-1">
                                        <div class="series-info d-flex align-items-center">
                                            <i class="fa fa-circle-o text-bold-700 text-primary"></i>
                                            <span class="text-bold-600 ml-50">سرمایه گذاری</span>
                                        </div>
                                        <div class="product-result">
                                            <span>{% random_fund_amount as amount %} {{amount|intcomma}}</span>
                                        </div>
                                    </div>
                                    <div class="chart-info d-flex justify-content-between mb-1">
                                        <div class="series-info d-flex align-items-center">
                                            <i class="fa fa-circle-o text-bold-700 text-warning"></i>
                                            <span class="text-bold-600 ml-50">اختصاص اعتبار</span>
                                        </div>
                                        <div class="product-result">
                                            <span>{% random_fund_amount as amount %} {{amount|intcomma}}</span>
                                        </div>
                                    </div>
                                    <div class="chart-info d-flex justify-content-between mb-75">
                                        <div class="series-info d-flex align-items-center">
                                            <i class="fa fa-circle-o text-bold-700 text-danger"></i>
                                            <span class="text-bold-600 ml-50">بدون استفاده</span>
                                        </div>
                                        <div class="product-result">
                                            <span>{% random_fund_amount as amount %} {{amount|intcomma}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>
{% endblock main %}

{% block page_js %}
<script src={% static "admin-theme/app-assets/vendors/js/charts/chart.min.js" %}></script>
<script src={% static "admin-theme/app-assets/vendors/js/charts/apexcharts.min.js" %}></script>

<script src={% static "admin-theme/app-assets/js/scripts/pages/dashboard-analytics.js" %}></script>
<script src={% static "admin-theme/app-assets/js/scripts/charts/chart-chartjs.js" %}></script>

<script>
    function generateRandomList(length) {
        const randomList = [];
        for (let i = 0; i < length; i++) {
            const randomValue = Math.floor(Math.random() * 100);
            randomList.push(randomValue);
        }
        return randomList;
    }

    var $primary = '#7367F0';
    var $danger = '#EA5455';
    var $warning = '#FF9F43';
    var $info = '#0DCCE1';
    var $primary_light = '#8F80F9';
    var $warning_light = '#FFC085';
    var $danger_light = '#f29292';
    var $info_light = '#1edec5';
    var $strok_color = '#b9c3cd';
    var $label_color = '#e7eef7';
    var $white = '#fff';
</script>

<script>
    //  Product Order Chart starts
  // -----------------------------

  var productChartoptions = {
    chart: {
      height: 325,
      type: 'radialBar',
    },
    colors: [$primary, $warning, $danger],
    fill: {
      type: 'gradient',
      gradient: {
        // enabled: true,
        shade: 'dark',
        type: 'vertical',
        shadeIntensity: 0.5,
        gradientToColors: [$primary_light, $warning_light, $danger_light],
        inverseColors: false,
        opacityFrom: 1,
        opacityTo: 1,
        stops: [0, 100]
      },
    },
    stroke: {
      lineCap: 'round'
    },
    plotOptions: {
      radialBar: {
        size: 165,
        hollow: {
          size: '20%'
        },
        track: {
          strokeWidth: '100%',
          margin: 15,
        },
        dataLabels: {
          name: {
            fontSize: '18px',
          },
          value: {
            fontSize: '16px',
          },
          total: {
            show: true,
            label: 'کل',

            formatter: function (w) {
              // By default this function returns the average of all series. The below is just an example to show the use of custom formatter function
              return {% random_fund_amount as amount %} {{amount}}
            }
          }
        }
      }
    },
    series: [31, 70, 9],
    labels: ['سرمایه گذاری', 'اختصاص اعتبار', 'بدون استفاده'],

  }

  var productChart = new ApexCharts(
    document.querySelector("#product-order-chart-custom"),
    productChartoptions
  );

  productChart.render();

  // Product Order Chart ends //
</script>
{% endblock page_js %}