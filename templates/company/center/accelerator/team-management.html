{% extends "base.html" %}

{% load static %}
{% load tag_library %}

{% block page_css %}
<link rel="stylesheet" type="text/css" href={% static "admin-theme/app-assets/vendors/css/tables/datatable/datatables.min.css" %}>
{% endblock page_css %}

{% block main %}
<div class="row">

	{% include "elements/messages-section.html" %}

	{% if request.user.is_center_staff %}
	<div class="col-12">
		<div class="row">
			<div class="col-md-3">
				<div class="card">
					<div class="card-header d-flex align-items-start pb-0">
						<div>
							<h2 class="text-bold-700 mb-0">{{valid_requests_count}}</h2>
							<p class="mt-25">درخواست های ارسالی تکمیل شده</p>
						</div>
						<div class="avatar bg-rgba-primary p-50 m-0">
							<div class="avatar-content">
								<i class="feather icon-package text-primary font-medium-5"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="card">
					<div class="card-header d-flex align-items-start pb-0">
						<div>
							<h2 class="text-bold-700 mb-0">{{approved_requests.count}}</h2>
							<p class="mt-25">درخواست های تایید شده</p>
						</div>
						<div class="avatar bg-rgba-success p-50 m-0">
							<div class="avatar-content">
								<i class="feather icon-check-square text-success font-medium-5"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

            <div class="col-md-3">
				<div class="card">
					<div class="card-header d-flex align-items-start pb-0">
						<div>
							<h2 class="text-bold-700 mb-0">{{rejected_requests.count}}</h2>
							<p class="mt-25">درخواست های رد شده</p>
						</div>
						<div class="avatar bg-rgba-danger p-50 m-0">
							<div class="avatar-content">
								<i class="feather icon-x-square text-danger font-medium-5"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="card">
					<div class="card-header d-flex align-items-start pb-0">
						<div>
							<h2 class="text-bold-700 mb-0">{{all_requests.count}}</h2>
							<p class="mt-25">کل درخواست های موجود</p>
						</div>
						<div class="avatar bg-rgba-info p-50 m-0">
							<div class="avatar-content">
								<i class="feather icon-folder text-info font-medium-5"></i>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title"><i class="fa fa-hashtag text-black-50"></i> لیست درخواست های تکمیل شده ارسالی برای <span class="font-weight-bold">"{{acc_object.accelerator_of_road.first.name}}"</span></h4>
            </div>
            <div class="card-content">
                <div class="card-body card-dashboard">
                    <div class="table-responsive">
                        <table class="table zero-configuration">
                            <thead>
                                <tr class="table-light">
									<th>نام و نام خانوادگی</th>
                                    <th>تیم</th>
                                    <th>تاریخ ارسال درخواست</th>
                                    <th>وضعیت</th>
                                    <th>امتیاز</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody>
								{% for item in valid_requests %}
									<tr>
										<td>{{item.user.get_full_name}}</td>
										<td>{% if item.team_or_individual in "ta" %}{{item.team.name}}{% else %}<span class="badge badge-primary">شخص</span>{% endif %}</td>
										<td>{{item.client_last_response_date|to_jalali}}</td>
										
										<td class="{% if item.status == "w" %}table-info{% elif item.status == "p" %}table-primary{% elif item.status == "a" %}table-success{% elif item.status == "r" %}table-danger{% elif item.status == "c" %}table-warning{% endif %}">{{item.get_status_display}}</td>
										
										<td>50 امتیاز</td>
										<td>
											<a href={% url "team:registration-detail" item.uuid %} class="badge badge-info">مشاهده <i class="feather icon-eye"></i></a>
										</td>
									</tr>
								{% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

	<div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title"><i class="fa fa-hashtag text-black-50"></i> لیست تمام درخواست ها برای <span class="font-weight-bold">"{{acc_object.accelerator_of_road.first.name}}"</span> (تکمیل شده و تکمیل نشده) </h4>
            </div>
            <div class="card-content">
                <div class="card-body card-dashboard">
                    <div class="table-responsive">
                        <table class="table zero-configuration">
                            <thead>
                                <tr class="table-light">
									<th>نام و نام خانوادگی</th>
                                    <th>تیم</th>
                                    <th>تاریخ ارسال درخواست</th>
                                    <th>تکمیل اطلاعات</th>
                                    <th>مهلت باقی مانده</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody>
								{% for item in all_requests %}
									<tr>
										<td>{{item.user.get_full_name}}</td>
										<td>{% if item.team_or_individual in "ta" %}{{item.team.name}}{% else %}<span class="badge badge-primary">شخص</span>{% endif %}</td>
										<td>{{item.client_last_response_date|to_jalali}}</td>
										
										
										<td>
											{% if item.team_or_individual == "t" %}
												{% if item.is_complete_registration_for_coordinator %}
												<span class="badge badge-success"><i class="feather icon-check"></i></span>
												{% else %}
												<span class="badge badge-danger"><i class="feather icon-x"></i></span>
												{% endif %}
											{% elif item.team_or_individual == "a" %}
												{% if item.is_complete_registration_for_team_member %}
												<span class="badge badge-success"><i class="feather icon-check"></i></span>
												{% else %}
												<span class="badge badge-danger"><i class="feather icon-x"></i></span>
												{% endif %}
											{% elif item.team_or_individual == "i" %}
												{% if item.is_complete_registration_for_individual %}
												<span class="badge badge-success"><i class="feather icon-check"></i></span>
												{% else %}
												<span class="badge badge-danger"><i class="feather icon-x"></i></span>
												{% endif %}
											{% endif %}
										</td>
										
										<td>{% if item.is_valid_registration_period > 1 %}<span class="badge badge-success">{{item.is_valid_registration_period}}</span>{% else %}<span class="badge badge-danger">{{item.is_valid_registration_period}}</span>{% endif %}</td>
										<td>
											<a href={% url "team:registration-detail" item.uuid %} class="badge badge-info">مشاهده <i class="feather icon-eye"></i></a>
										</td>
									</tr>
								{% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
	{% else %}
	<div class="col-12">
		<div class="card bg-gradient-danger">
			<div class="card-header d-flex align-items-start pb-0">
				<div class="mx-auto">
					<h2 class="text-bold-700 mb-1 text-white">شما به هیچ مرکزی دسترسی ندارید!</h2>
				</div>
			</div>
		</div>
	</div>

	<div class="col-12">
		<div class="card">
			<div class="card-content">
				<div class="card-body">
					<p class="">
						<h2 class="ml-1 mb-1 font-weight-bold">چه باید کرد؟</h2>
						<ul class="list-group">
							<li class="list-group-item">۱. ثبت تیکت برای پشتیبان وب سایت.</li>
						</ul>
					</p>
				</div>
			</div>
		</div>
	</div>
	{% endif %}

</div>
{% endblock main %}

{% block page_js %}
<script src={% static "admin-theme/app-assets/vendors/js/tables/datatable/datatables.min.js" %}></script>
<script src={% static "admin-theme/app-assets/vendors/js/tables/datatable/datatables.bootstrap4.min.js" %}></script>
<script src={% static "admin-theme/app-assets/js/scripts/datatables/datatable.js" %}></script>
{% endblock page_js %}